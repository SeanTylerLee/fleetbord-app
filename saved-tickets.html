<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Saved Tickets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <header class="ios-header-image"><img src="header.jpg" alt="Header" /></header>
  <div class="container">
    <h2>Saved Tickets</h2>
    <div id="list"></div>
    <canvas id="signPad" style="display:none; width:100%; height:150px; border:1px solid #ccc;"></canvas>
    <button id="signBtn" style="display:none;" onclick="saveSignature()">Add Signature</button>
    <button onclick="location.href='page5.html'">‚Üê Back</button>
  </div>

  <script>
    const list = document.getElementById("list");
    let currentKey = null;
    let signaturePad = new SignaturePad(document.getElementById("signPad"));

    for (let k in localStorage) {
      if (!k.startsWith("ticket_")) continue;

      const d = JSON.parse(localStorage.getItem(k));
      const div = document.createElement("div");
      div.className = "load-entry";
      div.innerHTML = `
        <strong>${d.date || "No Date"}</strong><br>
        Hauled By: ${d.hauledBy}<br>
        Destination: ${d.destination}<br>
        <button onclick="view('${k}')">View & Sign</button>
      `;
      list.appendChild(div);
    }

    function view(key) {
      currentKey = key;
      document.getElementById("signPad").style.display = "block";
      document.getElementById("signBtn").style.display = "inline-block";
    }

    function saveSignature() {
      if (!signaturePad || signaturePad.isEmpty()) return alert("Sign before submitting");

      const data = JSON.parse(localStorage.getItem(currentKey));
      data.signatureImage = signaturePad.toDataURL();
      localStorage.setItem(currentKey, JSON.stringify(data));
      alert("Signature saved.");
      signaturePad.off();
    }
  </script>
</body>
</html>