<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Dispatch</title>
  <link rel="stylesheet" href="styles.css" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
</head>
<body>
  <header class="ios-header-image">
    <img src="header.jpg" alt="Header" />
  </header>

  <div class="container">
    <h2 style="text-align:center; padding: 15px;">Dispatched Loads</h2>
    <div id="dispatchList"></div>
    <a class="ios-item" href="index.html">← Back to Home</a>
  </div>

  <script>
    const sampleDispatches = [
      {
        id: 1,
        pickupLocation: "Yard A",
        pickupTime: "2025-07-22 08:00 AM",
        deliveryLocation: "Site B",
        deliveryTime: "2025-07-22 01:00 PM",
        rate: "$850",
        customer: "ABC Energy Co.",
        fuelSurcharge: "$75",
        ticketType: "Individual Tickets",
        notes: "Watch out for site road construction.",
        assignedTo: ["driver1", "driver2"],
        accepted: false
      }
    ];

    const currentUser = "driver1"; // Placeholder (to be replaced with actual login system)
    const dispatchList = document.getElementById("dispatchList");
    dispatchList.innerHTML = "";

    const relevantLoads = sampleDispatches.filter(load => load.assignedTo.includes(currentUser));

    if (relevantLoads.length === 0) {
      dispatchList.innerHTML = `
        <div class="ios-list">
          <div class="ios-item">
            <strong>No loads currently dispatched.</strong>
            <p>Once a load is dispatched to you, it will appear here.</p>
          </div>
        </div>`;
    } else {
      relevantLoads.forEach(load => {
        const div = document.createElement("div");
        div.className = "dispatch-entry";
        div.innerHTML = `
          <strong>Pickup:</strong> ${load.pickupLocation}<br>
          <strong>Pickup Time:</strong> ${load.pickupTime}<br>
          <strong>Delivery:</strong> ${load.deliveryLocation}<br>
          <strong>Delivery Time:</strong> ${load.deliveryTime}<br>
          <strong>Rate:</strong> ${load.rate}<br>
          <strong>Customer:</strong> ${load.customer}<br>
          <strong>Fuel Surcharge:</strong> ${load.fuelSurcharge}<br>
          <strong>Ticket Type:</strong> ${load.ticketType}<br>
          <strong>Notes:</strong> ${load.notes}<br><br>
          <button onclick="acceptLoad(${load.id})">✅ Accept Load</button>
        `;
        dispatchList.appendChild(div);
      });
    }

    function acceptLoad(id) {
      alert("Load #" + id + " accepted.");
      // TODO: Save to backend or localStorage
    }

    if (localStorage.getItem('theme') === 'dark') {
      document.documentElement.classList.add('dark-mode');
    }
  </script>
</body>
</html>