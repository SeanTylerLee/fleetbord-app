<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="manifest" href="manifest.json" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <title>Passwords</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- Header Image -->
  <header>
    <img src="images/Header.PNG" alt="App Header" class="header-img">
  </header>

  <!-- Main content -->
  <main class="container">
    <div id="pinGate">
      <h2>Enter PIN to Access Passwords</h2>
      <input type="password" id="pinInput" placeholder="Enter PIN" />
      <button onclick="checkPin()" class="btn">Unlock</button>
    </div>

    <div id="passwordManager" style="display:none;">
      <h2>Saved Passwords</h2>
      <form id="passwordForm">
        <input type="text" id="title" placeholder="Title (e.g. Netflix)" required />
        <input type="text" id="username" placeholder="Username or Email" required />
        <input type="text" id="password" placeholder="Password" required />
        <button type="submit" class="btn">Save Password</button>
      </form>

      <ul id="passwordList" style="margin-top: 20px;"></ul>
    </div>
  </main>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="index.html">
      <img src="images/home.jpg" alt="Home" class="nav-icon">
    </a>
    <a href="settings.html">
      <img src="images/settings.jpg" alt="Settings" class="nav-icon">
    </a>
  </nav>

  <!-- Script -->
  <script>
    const pin = "5335";
    const pinInput = document.getElementById("pinInput");
    const pinGate = document.getElementById("pinGate");
    const manager = document.getElementById("passwordManager");
    const passwordForm = document.getElementById("passwordForm");
    const passwordList = document.getElementById("passwordList");

    let editingIndex = -1;

    const getPasswords = () => JSON.parse(localStorage.getItem("passwords") || "[]");
    const savePasswords = (data) => localStorage.setItem("passwords", JSON.stringify(data));

    function checkPin() {
      if (pinInput.value === pin) {
        pinGate.style.display = "none";
        manager.style.display = "block";
        renderPasswords();
      } else {
        alert("Incorrect PIN");
      }
    }

    function renderPasswords() {
      const passwords = getPasswords();
      passwordList.innerHTML = "";
      passwords.forEach((entry, i) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${entry.title}</strong><br>
          Username: ${entry.username}<br>
          Password: ${entry.password}<br>
          <button onclick="editPassword(${i})" class="btn-secondary">Edit</button>
          <button onclick="deletePassword(${i})" class="btn-delete">Delete</button>
          <hr>
        `;
        passwordList.appendChild(li);
      });
    }

    passwordForm.addEventListener("submit", function(e) {
      e.preventDefault();
      const passwords = getPasswords();
      const newEntry = {
        title: document.getElementById("title").value,
        username: document.getElementById("username").value,
        password: document.getElementById("password").value
      };

      if (editingIndex > -1) {
        passwords[editingIndex] = newEntry;
        editingIndex = -1;
      } else {
        passwords.push(newEntry);
      }

      savePasswords(passwords);
      passwordForm.reset();
      renderPasswords();
    });

    function editPassword(index) {
      const entry = getPasswords()[index];
      document.getElementById("title").value = entry.title;
      document.getElementById("username").value = entry.username;
      document.getElementById("password").value = entry.password;
      editingIndex = index;
    }

    function deletePassword(index) {
      const passwords = getPasswords();
      if (confirm("Delete this entry?")) {
        passwords.splice(index, 1);
        savePasswords(passwords);
        renderPasswords();
      }
    }
  </script>
</body>
</html>