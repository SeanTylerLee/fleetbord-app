<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fleetbord</title>
  <style>
    :root {
      --primary: #007aff;
      --background: #f2f2f7;
      --text: #1c1c1e;
      --card: #ffffff;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: var(--background);
      color: var(--text);
    }
    header {
      background-color: var(--primary);
      color: white;
      padding: 1rem;
      font-size: 1.5rem;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    main {
      padding: 1rem;
    }
    .card {
      background-color: var(--card);
      border-radius: 14px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      padding: 1rem;
      margin-bottom: 1rem;
    }
    input, button, select, textarea {
      width: 100%;
      padding: 0.75rem;
      margin-top: 0.5rem;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: var(--primary);
      color: white;
      border: none;
    }
    nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: white;
      border-top: 1px solid #ccc;
      display: flex;
      justify-content: space-around;
      padding: 0.5rem 0;
    }
    nav button {
      flex: 1;
      background: none;
      color: var(--primary);
      font-size: 1rem;
    }
    h2 {
      margin-top: 0;
    }
  </style>
</head>
<body>
  <header>Fleetbord</header>
  <main>
    <div class="card">
      <h2>Login</h2>
      <input type="email" placeholder="Email" />
      <input type="password" placeholder="Password" />
      <button onclick="login()">Sign In</button>
      <p style="text-align:center; margin-top:0.5rem;">
        or <a href="#" onclick="signup()">Sign Up</a>
      </p>
    </div>

    <div class="card">
      <h2>New Load</h2>
      <input type="text" placeholder="Ticket #" />
      <input type="text" placeholder="Customer" />
      <input type="text" placeholder="Lease" />
      <input type="text" placeholder="Rig" />
      <input type="number" placeholder="Rate" />
      <input type="number" placeholder="Overnights" />
      <input type="date" />
      <button onclick="submitLoad()">Submit Load</button>
    </div>

    <div class="card">
      <h2>Upload Paperwork</h2>
      <input type="file" />
      <button onclick="uploadFile()">Upload</button>
    </div>

    <div class="card">
      <h2>Messages</h2>
      <textarea placeholder="Type a message..."></textarea>
      <button onclick="sendMessage()">Send</button>
    </div>
  </main>

  <nav>
    <button>üè† Home</button>
    <button>üì¶ Loads</button>
    <button>üì§ Upload</button>
    <button>üí¨ Chat</button>
    <button>‚öôÔ∏è Settings</button>
  </nav>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyDZajwhXvmLdgy_daqmYB83XB-e1TgT0KA",
  authDomain: "fleetbord-11dfd.firebaseapp.com",
  projectId: "fleetbord-11dfd",
  storageBucket: "fleetbord-11dfd.appspot.com",
  messagingSenderId: "264094852958",
  appId: "1:264094852958:web:3aefa90034e5631a2851cf"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

const emailInput = document.querySelector('input[type="email"]');
const passwordInput = document.querySelector('input[type="password"]');
const loadInputs = document.querySelectorAll('.card:nth-of-type(2) input');
const fileInput = document.querySelector('input[type="file"]');
const messageBox = document.querySelector('textarea');
const messageLog = document.createElement('div');
document.querySelector('.card:last-of-type').appendChild(messageLog);

window.login = async () => {
  try {
    await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    alert("Logged in");
  } catch (err) {
    alert("Login failed: " + err.message);
  }
};

window.signup = async () => {
  try {
    await createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    alert("Signed up");
  } catch (err) {
    alert("Signup failed: " + err.message);
  }
};

window.submitLoad = async () => {
  const [ticket, customer, lease, rig, rate, nights, date] = [...loadInputs].map(i => i.value);
  try {
    await addDoc(collection(db, "loads"), {
      ticket, customer, lease, rig,
      rate: parseFloat(rate), overnights: parseInt(nights), date,
      user: auth.currentUser?.email,
      time: serverTimestamp()
    });
    alert("Load saved");
  } catch (e) {
    alert("Error: " + e.message);
  }
};

window.uploadFile = async () => {
  const file = fileInput.files[0];
  if (!file) return alert("Choose a file");
  const fileRef = ref(storage, "uploads/" + file.name);
  try {
    await uploadBytes(fileRef, file);
    alert("Uploaded");
  } catch (e) {
    alert("Upload failed: " + e.message);
  }
};

window.sendMessage = async () => {
  const text = messageBox.value;
  if (!text) return;
  await addDoc(collection(db, "messages"), {
    text,
    user: auth.currentUser?.email,
    time: serverTimestamp()
  });
  messageBox.value = "";
};

onSnapshot(query(collection(db, "messages"), orderBy("time")), snap => {
  messageLog.innerHTML = "";
  snap.forEach(doc => {
    const m = doc.data();
    const t = m.time?.toDate?.().toLocaleString() ?? "";
    messageLog.innerHTML += `<p><b>${m.user}</b>: ${m.text} <small>${t}</small></p>`;
  });
});
</script>

</body>
</html>