<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Schedule</title>
  <link rel="stylesheet" href="styles.css" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <style>
    .calendar-month {
      margin-bottom: 2rem;
      padding: 0 1rem;
    }

    .calendar-month h3 {
      text-align: center;
      margin-bottom: 0.5rem;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      font-size: 14px;
    }

    .calendar-day {
      border: 1px solid #ccc;
      padding: 8px;
      min-height: 60px;
      position: relative;
      background: var(--bg2, #f9f9f9);
      border-radius: 6px;
    }

    .calendar-day span.date {
      font-weight: bold;
      display: block;
    }

    .calendar-day .off-label {
      font-size: 12px;
      margin-top: 4px;
      color: var(--text2, #333);
      white-space: pre-wrap;
    }

    .calendar-day.editable:hover {
      background-color: #e6f7ff;
      cursor: pointer;
    }

    .back-btn {
      text-align: center;
      margin: 1rem;
    }
  </style>
</head>
<body>
  <header class="ios-header-image">
    <img src="header.jpg" alt="Header" />
  </header>

  <div class="container">
    <h2 style="text-align:center;">üóìÔ∏è Schedule / Who‚Äôs Off</h2>
    <div id="calendarContainer"></div>
    <div class="back-btn">
      <a class="ios-item" href="index.html">‚Üê Back to Home</a>
    </div>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem("currentUser") || "{}");
    const canEdit = user.role === "admin" || user.role === "office";
    const schedule = JSON.parse(localStorage.getItem("offSchedule") || "{}");

    const months = [
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];

    const calendarContainer = document.getElementById("calendarContainer");
    const currentYear = new Date().getFullYear();

    function buildCalendar() {
      calendarContainer.innerHTML = "";
      for (let month = 0; month < 12; month++) {
        const monthDiv = document.createElement("div");
        monthDiv.className = "calendar-month";
        monthDiv.innerHTML = `<h3>${months[month]} ${currentYear}</h3>`;
        const grid = document.createElement("div");
        grid.className = "calendar-grid";

        const firstDay = new Date(currentYear, month, 1).getDay();
        const daysInMonth = new Date(currentYear, month + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) {
          const empty = document.createElement("div");
          grid.appendChild(empty);
        }

        for (let day = 1; day <= daysInMonth; day++) {
          const key = `${currentYear}-${month + 1}-${day}`;
          const cell = document.createElement("div");
          cell.className = "calendar-day";
          if (canEdit) cell.classList.add("editable");
          cell.innerHTML = `<span class="date">${day}</span><div class="off-label">${schedule[key] || ""}</div>`;
          if (canEdit) {
            cell.onclick = () => {
              const currentNote = schedule[key] || "";
              const who = prompt(`Who's off on ${months[month]} ${day}?`, currentNote);
              if (who !== null) {
                schedule[key] = who.trim();
                localStorage.setItem("offSchedule", JSON.stringify(schedule));
                buildCalendar(); // refresh
              }
            };
          }
          grid.appendChild(cell);
        }

        monthDiv.appendChild(grid);
        calendarContainer.appendChild(monthDiv);
      }
    }

    // Dark mode check
    if (localStorage.getItem("theme") === "dark") {
      document.documentElement.classList.add("dark-mode");
    }

    buildCalendar();
  </script>
</body>
</html>